<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Carta Especial</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: #f5f5f5;
      overflow-y: auto; /* üëâ Scroll en toda la p√°gina */
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 30px 0;
    }

    .envelope {
      position: relative;
      width: 500px;   /* üìè Ancho fijo */
      height: 300px;  /* üìè Alto fijo */
      background: #d4a373;
      cursor: pointer;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: transform 0.5s;
      z-index: 10;
      margin: auto;
    }

    .envelope:hover {
      transform: scale(1.05);
    }

    .letter {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%) translateY(-100%);
      width: 450px;   /* üìè Igual al sobre */
      min-height: 200px; /* üìè Igual al sobre */
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      opacity: 0;
      transition: all 1s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      z-index: 20;
    }

    .envelope.open .letter {
      transform: translateX(-50%) translateY(-250px);
      opacity: 1;
    }

    .heart-btn {
      margin-top: 15px;
      font-size: 30px;
      cursor: pointer;
      border: none;
      background: none;
      color: #e6ccb2;
      transition: transform 0.3s;
    }

    .heart-btn:hover {
      transform: scale(1.2);
    }

    /* Fotos tipo Polaroid */
    #fotos {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 10px;
    }

    .polaroid {
      background: #fff;
      padding: 8px 8px 20px 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      border: 1px solid #ccc;
      max-width: 100px;
      transition: transform 0.3s;
    }

    .polaroid img {
      max-width: 100%;
      display: block;
    }

    .polaroid:hover {
      transform: scale(1.1) rotate(0deg);
      z-index: 30;
    }

    video {
      max-width: 100%;
      margin: 10px 0;
      border: 4px solid #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      background: #fafafa;
      padding: 5px;
    }

    /* Lluvia de corazones */
    .heart-container {
      position: fixed;
      top: -10px;
      animation: fall linear forwards;
      pointer-events: none;
    }

    @keyframes fall {
      to { top: 110vh; opacity: 0; }
    }

    .heart {
      display: inline-block;
      animation: sway ease-in-out infinite, spin ease-in-out infinite;
      transform-origin: center;
    }

    @keyframes sway {
      0%   { transform: translateX(0); }
      25%  { transform: translateX(-20px); }
      50%  { transform: translateX(20px); }
      75%  { transform: translateX(-15px); }
      100% { transform: translateX(0); }
    }

    @keyframes spin {
      0%   { transform: rotate(0deg); }
      50%  { transform: rotate(25deg); }
      100% { transform: rotate(-25deg); }
    }
  </style>
</head>
<body>
  <div class="envelope" onclick="openLetter()">
    <div class="letter" id="letter">
      <h2 id="titulo">üíå Para el amor de mi vida üíå</h2>
      <p id="mensaje">para el amor de mi vida, una carta que no puede morir jamas. Hoy es un dia muy especial para pasar contigo, gracias por hacerme tan feliz por hacerme una persona tan afortunada para tenerte en toda mi vida, eres de lo mas importante que me ha pasado y quiero que sepas que no dejo de pensar en ti jamas, quiero hacer todo contigo, mejorar contigo, vivir contigo, tener una vida contigo y soy tan feliz y afortunado de tenerte, verte crecer, madurar, vivir, expresarte y amar con todo el corazon solo hace que me sienta mas feliz y orgulloso de tenerte en mi vida, lo vales todo, vales el tiempo, el esfuerzo, el valor, el amor y mi vida lo vale mas cuando estoy a tu lado, te amo mi amorn todo esto te lo digo como si te lo expresara con rapidez pero al tiempo con amor, pasion y ternura, como si me quedara sin aliento al verte y al expresar todo lo que siento como si fuera la primera vez que te di un beso o que te agarre de la mano, me haces suspirar, me ayudas a mejorar pero sobre todo te amo porque el amor eres tu y mi amor va junto con el tuyo, porque tal vez y solo tal vez la vida realmente nos creo para estar juntos, algo que realmente realmente valio totalmente la pena esperar, todo para esto, para una vida perfecta con imperfecciones a tu lado, una vida que lo vale todo si lo estoy contigo, porque contigo es mas facil vivir, so√±ar y creer en las cosas buenas que pasan, contigo y por ti viviria toda la vida lo daria todo y m√°s y en algun punto de nuestras vidas poder tener el gusto de morir enamorados, morir por tu amor, morir por tu calidez, por tu belleza, morir viendo tus ojos marrones, tu lunar en el ojo, tu tierna nariz, morir con un ultimo beso y abrazo tuyo, con una ultima agarrada de manos... morir de amor como dicen algunos, morir con tu amor ‚ù§Ô∏è</p>
      <div id="fotos"></div>
      <video id="video" controls style="display:none;">
        <source src="video.mp4" type="video/mp4">
      </video>
      <button class="heart-btn" onclick="editar(event)">‚ù§</button>
    </div>
  </div>

  <audio id="music" loop></audio>

  <script>
    let raining = false;
    const music = document.getElementById('music');

    (function initMusic(){
      const savedSong = localStorage.getItem('song');
      music.src = savedSong ? savedSong : 'cancion.mp3';
      music.volume = 0.7;
      music.preload = 'auto';
    })();

    function openLetter() {
      const envelope = document.querySelector(".envelope");
      envelope.classList.toggle("open");

      if (envelope.classList.contains("open")) {
        if (!raining) { raining = true; startHearts(); }
        music.play().catch(()=>{});
      } else {
        try {
          music.pause();
          music.currentTime = 0;
        } catch(e){}
      }

      if(localStorage.getItem("titulo")) document.getElementById("titulo").innerText = localStorage.getItem("titulo");
      if(localStorage.getItem("mensaje")) document.getElementById("mensaje").innerText = localStorage.getItem("mensaje");

      // Fotos
      const fotosDiv = document.getElementById("fotos");
      fotosDiv.innerHTML = "";
      const fotos = JSON.parse(localStorage.getItem("fotos") || "[]");
      fotos.forEach(url => {
        const wrapper = document.createElement("div");
        wrapper.classList.add("polaroid");
        wrapper.style.transform = `rotate(${Math.random()*20 - 10}deg)`;
        const img = document.createElement("img");
        img.src = url.trim();
        wrapper.appendChild(img);
        fotosDiv.appendChild(wrapper);
      });

      const video = localStorage.getItem("video");
      if (video) {
        const vid = document.getElementById("video");
        vid.querySelector('source').src = video;
        vid.load();
        vid.style.display = "block";
      } else {
        document.getElementById("video").style.display = "none";
      }
    }

    function editar(e) {
      e.stopPropagation();
      window.location.href = "editar.html";
    }

    function startHearts() {
      const colors = ["#e6ccb2", "#6c757d", "#7b3f00", "#800020"];
      const spawnInterval = 300;
      setInterval(() => {
        const container = document.createElement("div");
        container.classList.add("heart-container");
        const heart = document.createElement("div");
        heart.classList.add("heart");
        heart.innerText = "‚ù§";
        heart.style.color = colors[Math.floor(Math.random() * colors.length)];
        heart.style.fontSize = (18 + Math.random() * 26) + "px";
        const fallTime = 5 + Math.random() * 4;
        const swayTime = 2 + Math.random() * 2;
        const spinTime = 3 + Math.random() * 3;
        container.style.left = Math.random() * 100 + "vw";
        container.style.animationDuration = fallTime + "s";
        heart.style.animationDuration = `${swayTime}s, ${spinTime}s`;
        heart.style.transform = `rotate(${Math.random() * 60 - 30}deg)`;
        container.style.zIndex = Math.random() > 0.5 ? "5" : "25";
        container.appendChild(heart);
        document.body.appendChild(container);
        setTimeout(() => container.remove(), (fallTime + 0.5) * 1000);
      }, spawnInterval);
    }

    window.addEventListener('storage', (e) => {
      if (e.key === 'song') {
        music.src = e.newValue ? e.newValue : 'cancion.mp3';
        music.load();
      }
    });
  </script>
</body>
</html>
